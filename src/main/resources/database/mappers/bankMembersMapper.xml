<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.iu.start.bankMembers.BankMembersDAO">
	<select id="getLogin" parameterType="BankMembersDTO" resultType="BankMembersDTO"> <!-- mybatisConfig파일에 넣어주면된다. -->
		select id, name from bankmembers where id=#{id} and pw=#{pw}
	</select>
	
	<select id="getMine" parameterType="BankMembersDTO" resultType="BankMembersDTO">
		select id,name,pw,email,phone,lv from bankmembers where id=#{id}
	</select>
	
	<select id="getMyPage" parameterType="BankMembersDTO" resultMap="getMyPageResult">
		SELECT ID, NAME, EMAIL, PHONE, ACNUM, BOOKNUM, ACDATE
		FROM BANKMEMBERS bm INNER JOIN BANKACCOUNT ba USING (ID)
		inner join BANKBOOK bb using (BOOKNUM)
		WHERE ID=#{id}
	</select>
	
	<resultMap type="BankMembersDTO" id="getMyPageResult">
		<id column="ID" property="id"/>
		<result column="NAME" property="name"/>
		<result column="EMAIL" property="email"/>
		<result column="PHONE" property="phone"/>
		
		<!-- 1:N의 관계에서는 collection을 쓴다. -->
		<collection property="bankAccountDTOs" javaType="List" ofType="BankAccountDTO">
			<id column="ACNUM" property="acnum"/>
			<result column="ACDATE" property="acdate"/>
			
			<association property="bankBookDTO" javaType="BankBookDTO">
				<result column="BOOKNUM" property="booknum"/>
			</association>
		
		</collection>
		
	</resultMap>
	
</mapper>